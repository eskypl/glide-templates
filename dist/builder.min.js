!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof exports&&(module.exports=b())}(this,function(){var a,b,c,d,e;return a=function(){function a(a){this.tagResolvers={},this.deps=[];for(var b in this.tagDefinisions)this.tagResolvers[b]=this.compileTag(b,a[b])}return a.prototype={compileTag:function(a,b){return[new RegExp("{"+this.tagDefinisions[a]+"}","g"),this.giveContext(b)]},getResolvedDependencies:function(){return this.deps||[]},tagDefinisions:{conditional:"if\\s+(.+?)",conditionalElse:"else",conditionalElseIf:"else\\s+(.+?)",conditionalEnd:"\\/if",loop:"foreach\\s+(.+?)\\s+as\\s+(\\$\\w+)",loopEnd:"\\/foreach",loopExpression:"@([a-z]+)",expression:"(\\$.+?)",include:"include\\s+template=(.+?)\\s*(\\s*[a-z]+[a-z0-9]*=.+?)?",translate:"i18n\\s+key=(.+?)\\s*(\\s*[a-zA-Z0-9]+=.+?)?",comment:"\\*\\s+.+?\\s+\\*",debug:"debug\\s+var=(\\$.+?)",assign:"assign\\s+var=(\\$\\w+)\\s+value=(.+?)"}},a}(),b=function(){function a(a){this.tagResolvers=[],this.deps=[];for(var b in this.tagDefinisions)this.tagResolvers[b]=this.compileTag(b,a[b])}return a.prototype={compileTag:function(a,b){var c,d=this.tagDefinisions[a],e=d,f=b;return d instanceof Array&&(e=d[0],f=d[1]),c="expression"===a||"loopExpression"===a?"{{\\s*"+e+"\\s*}}":"comment"===a?"{#\\s*"+e+"\\s*#}":"{%\\s*"+e+"\\s*%}",[new RegExp(c,"g"),this.giveContext(f)]},getResolvedDependencies:function(){return this.deps||[]},tagDefinisions:{conditional:"if\\s+(.+?)",conditionalElse:"else",conditionalElseIf:"else\\s+(.+?)",conditionalEnd:"endif",loop:["for\\s+(\\$\\w+)\\s+in\\s+(.+?)",'";_this.e($2,function($1,i){_+="'],loopEnd:"endfor",loopExpression:"@([a-z]+)",expression:"(\\$.+?)",include:"include\\s+'(.+?)'(?:\\s+with\\s+(.+?))?",translate:"i18n\\s+'(.+?)'(?:\\s+with\\s+(.+?))?",comment:"\\s+.+?\\s+",debug:"debug\\s+(\\$.+?)",assign:"set\\s+(\\$\\w+)\\=(.+?)"}},a}(),c=function(a,b){function c(a){if(!0===g.test(a))return d(a);for(var b,c=[],e=a.split(f),h=0,i=e.length;i>h;h++)b=e[h].split("="),0===b[1].indexOf("@")?b[1]="i."+b[1].substr(1):0!==b[1].indexOf("$")&&(b[1]='"'+b[1]+'"'),c.push('"'+b[0]+'":'+b[1]);return"{"+c.join(",")+"}"}function d(a){return a?a.replace("@","i."):void 0}var e={smarty:a,twig:b},f=/\s+/,g=/^{(\s*[a-z][a-z0-9]*:\s*@?[\w\$\.\[\]\(\)]+\s*)(,\s*[a-z][a-z0-9]*:\s*@?[\w\$\.\[\]\(\)]+\s*)*}$/i,h={conditional:function(a,b){return'";if('+d(b)+'){_+="'},conditionalElse:'";}else{_+="',conditionalElseIf:function(a,b){return'";}else if('+d(b)+'){_+="'},conditionalEnd:'";}_+="',loop:'";_this.e($1,function($2,i){_+="',loopEnd:'";});_+="',loopExpression:'"+i.$1+"',expression:'"+$1+"',include:function(a,b,d){var e="";return d&&(e=c(d)),this.deps.push("view!"+b+".tpl"),'"+_this.f('+(this.deps.length-1)+","+(e?e:"$tpl")+')+"'},translate:function(a,b,d){var e="";return d&&(e=","+c(d)),'"+_this.t("'+b+'"'+e+')+"'},comment:"",debug:function(a,b){return'";console.log('+d(b)+');_+="'},assign:function(a,b,c){return'";var '+b+"="+d(c)+';_+="'}},i={giveContext:function(a){if("function"!=typeof a)return a;var b=this,c=function(){},d=function(){return a.apply(a instanceof c&&b?a:b,Array.prototype.slice.call(arguments))};return c.prototype=a.prototype,d.prototype=new c,d}};for(var j in e)for(var k in i)e[j].prototype[k]=i[k];return function(a){if(!a)throw"Missing template syntax name";var b=a.toLowerCase();if(!e[b])throw"Unsupported templateing syntax style";return new e[b](h)}}(a,b),d=function(a){function b(a){return"string"==typeof a&&a.length?a.replace(e,"").replace(f,"\\$&").replace(g,"&"):a}function c(a){return a.replace(/_\+="";/g,"").replace(/=""\+/g,"=").replace(/\+"";/g,";")}function d(d,e){var f,g=b(d),j=h[i[e]],k=new a(j),l=k.tagResolvers;for(var m in l)g=g.replace(l[m][0],l[m][1]);g=c('var _this=this,_="";_+="'+g+'";return _;');try{return f=new Function("$tpl",g),f.deps=k.getResolvedDependencies(),f}catch(n){throw n instanceof SyntaxError&&(n.message+=' in "'+g+'"'),"Template compilation error: "+n.stack||n.message}}var e=/^\s*|\r|\n|\t|\s*$/g,f=/"/g,g=/&amp;/g,h=["smarty","twig"],i={tpl:0,smarty:0,twig:1};return d}(c),e=function(a){function b(a){var b=a.match(/\.(\w+)$/i);return b&&b.length?b[1].toLowerCase():b}function c(a){return function(b){var c=f.exec(b);return a+"!"+(c?c[1]:name)}}function d(a){return a.replace(/[^a-z]./gi,function(a){return String(a).substr(1).toUpperCase()})}var e={},f=/^\w+!(.+?)\.\w+$/i;return{version:"1.0.0",compile:a,load:function(c,d,f){var g,h=require.nodeRequire("fs");try{g=h.readFileSync(d.toUrl(c),"utf8"),0===g.indexOf("ï»¿")&&(g=g.substring(1))}catch(i){f.error(i)}var j=a(g,b(c));e[c]=j,j.deps.length,f()},write:function(a,b,f){var g,h=e[b],i=b.replace(/\.\w+$/i,""),j=d(b),k=h.toString().replace("function anonymous","function "+j),l="",m="";h.deps.length&&(g=c(a),l='["'+h.deps.map(g).join('","')+'"],',m=j+".includes=arguments;"),f.asModule(i,"define("+l+"function(){"+k+";"+m+"return "+j+";});")}}}(d)});